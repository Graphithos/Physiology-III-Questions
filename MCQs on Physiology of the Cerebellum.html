<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCQs on Physiology 3 Lecture No. 8 Quiz</title>
    <style>
        :root {
            --bg-color: #f5f7fa;
            --container-bg: white;
            --text-color: #333;
            --border-color: #ddd;
            --primary-color: #3498db;
            --header-color: #2c3e50;
            --secondary-text: #7f8c8d;
            --progress-bg: #ecf0f1;
            --question-bg: #f8f9fa;
            --option-bg: #fff;
            --option-hover: #f1f8ff;
            --option-selected: #d1ecf1;
            --correct-bg: #d4edda;
            --correct-border: #28a745;
            --incorrect-bg: #f8d7da;
            --incorrect-border: #dc3545;
            --button-bg: #3498db;
            --button-hover: #2980b9;
            --button-disabled: #bdc3c7;
            --restart-bg: #2ecc71;
            --restart-hover: #27ae60;
            --review-bg: #f39c12;
            --review-hover: #e67e22;
            --toggle-bg: #ecf0f1;
            --toggle-slider: white;
            --toggle-text: #7f8c8d;
        }

        .dark-mode {
            --bg-color: #1a1a2e;
            --container-bg: #16213e;
            --text-color: #e6e6e6;
            --border-color: #394867;
            --primary-color: #4cc9f0;
            --header-color: #e6e6e6;
            --secondary-text: #a9a9a9;
            --progress-bg: #394867;
            --question-bg: #1f4068;
            --option-bg: #16213e;
            --option-hover: #1f4068;
            --option-selected: #1f4068;
            --correct-bg: #2d5a2d;
            --correct-border: #4caf50;
            --incorrect-bg: #5a2d2d;
            --incorrect-border: #f44336;
            --button-bg: #4cc9f0;
            --button-hover: #3aa8d0;
            --button-disabled: #5d6d7e;
            --restart-bg: #2ecc71;
            --restart-hover: #27ae60;
            --review-bg: #f39c12;
            --review-hover: #e67e22;
            --toggle-bg: #394867;
            --toggle-slider: #4cc9f0;
            --toggle-text: #e6e6e6;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            transition: background-color 0.3s, color 0.3s;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: var(--container-bg);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s, box-shadow 0.3s;
        }
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--primary-color);
            position: relative;
        }
        h1 {
            color: var(--header-color);
            margin-bottom: 5px;
            font-size: 24px;
            transition: color 0.3s;
        }
        .author {
            color: var(--secondary-text);
            font-style: italic;
            margin-bottom: 10px;
            transition: color 0.3s;
        }
        .description {
            color: var(--secondary-text);
            margin-bottom: 20px;
            transition: color 0.3s;
        }
        .theme-toggle {
            position: absolute;
            top: 35px;
            right: 0;
            display: flex;
            align-items: center;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 120px;
            height: 34px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--toggle-bg);
            transition: .4s;
            border-radius: 34px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
            font-size: 12px;
            font-weight: bold;
            color: var(--toggle-text);
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 60px;
            left: 4px;
            bottom: 4px;
            background-color: var(--toggle-slider);
            transition: .4s;
            border-radius: 34px;
            z-index: 1;
        }
        .slider-text {
            position: relative;
            z-index: 2;
            width: 100%;
            display: flex;
            justify-content: space-between;
        }
        .light-text, .dark-text {
            transition: opacity 0.3s;
        }
        .dark-mode .light-text {
            opacity: 0.5;
        }
        .light-text {
            opacity: 0.5;
        }
        .dark-mode .dark-text {
            opacity: 1;
        }
        .dark-text {
            opacity: 0.5;
        }
        input:checked + .slider:before {
            transform: translateX(52px);
        }
        .progress-container {
            background: var(--progress-bg);
            border-radius: 5px;
            margin-bottom: 20px;
            position: relative;
            height: 10px;
            transition: background-color 0.3s;
        }
        .progress-bar {
            height: 100%;
            background: var(--primary-color);
            border-radius: 5px;
            width: 0%;
            transition: width 0.3s ease, background-color 0.3s;
        }
        .stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-weight: bold;
            color: var(--header-color);
            transition: color 0.3s;
        }
        .question {
            background: var(--question-bg);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: background-color 0.3s;
        }
        .question-number {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
            transition: color 0.3s;
        }
        .question-text {
            font-size: 18px;
            margin-bottom: 15px;
        }
        .options {
            display: grid;
            grid-gap: 10px;
        }
        .option {
            padding: 12px 15px;
            background: var(--option-bg);
            border: 2px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .option:hover {
            background: var(--option-hover);
            border-color: var(--primary-color);
        }
        .option.selected {
            background: var(--option-selected);
            border-color: var(--primary-color);
        }
        .option.correct {
            background: var(--correct-bg);
            border-color: var(--correct-border);
        }
        .option.incorrect {
            background: var(--incorrect-bg);
            border-color: var(--incorrect-border);
        }
        .feedback {
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            display: none;
        }
        .feedback.correct {
            background: var(--correct-bg);
            color: var(--text-color);
            border: 1px solid var(--correct-border);
            display: block;
        }
        .feedback.incorrect {
            background: var(--incorrect-bg);
            color: var(--text-color);
            border: 1px solid var(--incorrect-border);
            display: block;
        }
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        button {
            padding: 10px 20px;
            background: var(--button-bg);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        button:hover {
            background: var(--button-hover);
        }
        button:disabled {
            background: var(--button-disabled);
            cursor: not-allowed;
        }
        .results {
            text-align: center;
            padding: 30px;
            display: none;
        }
        .score {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--header-color);
        }
        .score-value {
            font-size: 48px;
            color: var(--primary-color);
            font-weight: bold;
        }
        .restart-btn {
            margin-top: 20px;
            background: var(--restart-bg);
        }
        .restart-btn:hover {
            background: var(--restart-hover);
        }
        .review-btn {
            margin-top: 20px;
            background: var(--review-bg);
        }
        .review-btn:hover {
            background: var(--review-hover);
        }
        .review-section {
            margin-top: 30px;
            padding: 20px;
            background: var(--question-bg);
            border-radius: 8px;
            display: none;
        }
        .review-title {
            font-size: 20px;
            margin-bottom: 15px;
            color: var(--header-color);
            text-align: center;
        }
        .review-question {
            margin-bottom: 20px;
            padding: 15px;
            border-left: 4px solid var(--incorrect-border);
            background: var(--container-bg);
            border-radius: 4px;
        }
        .review-question-number {
            font-weight: bold;
            color: var(--incorrect-border);
            margin-bottom: 8px;
        }
        .review-question-text {
            margin-bottom: 10px;
        }
        .review-answer {
            margin-top: 8px;
            font-weight: bold;
        }
        .review-correct {
            color: var(--correct-border);
        }
        .review-explanation {
            margin-top: 5px;
            font-style: italic;
            color: var(--secondary-text);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>MCQs on Physiology 3 Lecture No. 8 Quiz</h1>
            <p class="author">Dr. Samy Salem</p>
            <p class="description">Test your knowledge of the Cerebellum and Motor Coordination</p>
            <div class="theme-toggle">
                <label class="switch">
                    <input type="checkbox" id="dark-mode-toggle">
                    <span class="slider">
                        <div class="slider-text">
                            <span class="light-text">Light</span>
                            <span class="dark-text">Dark</span>
                        </div>
                    </span>
                </label>
            </div>
        </header>

        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>

        <div class="stats">
            <div>Question: <span id="current-question">1</span>/<span id="total-questions">30</span></div>
            <div>Score: <span id="score">0</span>/<span id="total-score">30</span></div>
        </div>

        <div id="quiz-container">
            <!-- Questions will be inserted here by JavaScript -->
        </div>

        <div class="navigation">
            <button id="prev-btn" disabled>Previous</button>
            <button id="next-btn">Next</button>
        </div>

        <div id="results" class="results">
            <div class="score">Your Score: <span class="score-value" id="final-score">0</span>/30</div>
            <p id="performance-message"></p>
            <button class="restart-btn" id="restart-btn">Restart Quiz</button>
            <button class="review-btn" id="review-btn">Review Incorrect Answers</button>
        </div>

        <div id="review-section" class="review-section">
            <h2 class="review-title">Questions Answered Incorrectly</h2>
            <div id="incorrect-questions-list"></div>
        </div>
    </div>

    <script>
        // Quiz data from Physiology 3 Lecture No. 8
        const originalQuizData = [
            {
                question: "Approximately what percentage of the brain's mass does the cerebellum make up?",
                options: [
                    "5%",
                    "11%",
                    "20%",
                    "33%"
                ],
                answer: 1,
                explanation: "11% (Page 3)"
            },
            {
                question: "Cerebellar activity occurs at what level of consciousness?",
                options: [
                    "Consciously",
                    "Subconsciously",
                    "Both consciously and subconsciously",
                    "Only during sleep"
                ],
                answer: 1,
                explanation: "Subconsciously (Page 3)"
            },
            {
                question: "Which of the following is the largest cerebellar nucleus?",
                options: [
                    "Fastigial nucleus",
                    "Globose nucleus",
                    "Emboliform nucleus",
                    "Dentate nucleus"
                ],
                answer: 3,
                explanation: "Dentate nucleus (Page 7)"
            },
            {
                question: "The fastigial nucleus is primarily related to the regulation of:",
                options: [
                    "Coordination of limb movements.",
                    "Body posture and is related to the flocculonodular lobe.",
                    "Distal limb precision.",
                    "Motor planning for extremities."
                ],
                answer: 1,
                explanation: "Body posture and is related to the flocculonodular lobe. (Page 7)"
            },
            {
                question: "The lateral hemispheres of the cerebellum are primarily responsible for:",
                options: [
                    "Motor planning for extremities.",
                    "Balance and vestibulo-ocular reflexes.",
                    "Distal limb coordination.",
                    "Proximal limb and trunk coordination."
                ],
                answer: 0,
                explanation: "Motor planning for extremities. (Page 9)"
            },
            {
                question: "The vermis and flocculonodular lobe are functionally associated with:",
                options: [
                    "Distal limb coordination.",
                    "Proximal limb and trunk coordination, balance, and vestibulo-ocular reflexes.",
                    "Motor planning for extremities.",
                    "Timing of sequential movements."
                ],
                answer: 1,
                explanation: "Proximal limb and trunk coordination, balance, and vestibulo-ocular reflexes. (Page 9)"
            },
            {
                question: "Which cerebellar peduncle carries predominantly efferent (output) fibers from the cerebellum to the thalamus and red nucleus?",
                options: [
                    "Inferior cerebellar peduncle",
                    "Middle cerebellar peduncle",
                    "Superior cerebellar peduncle",
                    "All three equally"
                ],
                answer: 2,
                explanation: "Superior cerebellar peduncle (Page 10)"
            },
            {
                question: "The middle cerebellar peduncle carries mainly afferent fibers from:",
                options: [
                    "The spinal cord.",
                    "The vestibular apparatus.",
                    "The pontine nuclei (receiving input from the cerebral cortex).",
                    "The reticular formation."
                ],
                answer: 2,
                explanation: "The pontine nuclei (receiving input from the cerebral cortex). (Page 10)"
            },
            {
                question: "The approximate ratio of afferent to efferent fibers entering/leaving the cerebellum is:",
                options: [
                    "1:40",
                    "10:1",
                    "40:1",
                    "100:1"
                ],
                answer: 2,
                explanation: "40:1 (Page 10)"
            },
            {
                question: "The dentate nucleus projects its output contralaterally primarily to:",
                options: [
                    "The contralateral thalamus and then to the motor cortex.",
                    "The ipsilateral red nucleus.",
                    "The vestibular nuclei directly.",
                    "The spinal cord via the rubrospinal tract."
                ],
                answer: 0,
                explanation: "The contralateral thalamus and then to the motor cortex. (Page 12)"
            },
            {
                question: "The emboliform and globose nuclei project mainly to the:",
                options: [
                    "Vestibular nuclei.",
                    "Contralateral red nuclei.",
                    "Ipsilateral motor cortex.",
                    "Reticular formation."
                ],
                answer: 1,
                explanation: "Contralateral red nuclei. (Page 12)"
            },
            {
                question: "The fastigial nucleus projects to which structures to influence posture?",
                options: [
                    "Thalamus and motor cortex",
                    "Vestibular nuclei and reticular formation",
                    "Red nucleus and pontine nuclei",
                    "Inferior olivary nucleus"
                ],
                answer: 1,
                explanation: "Vestibular nuclei and reticular formation (Page 12)"
            },
            {
                question: "A primary function of the cerebellum is to act as a:",
                options: [
                    "Primary initiator of voluntary movement.",
                    "Center for conscious perception of pain.",
                    "Relay station for auditory information.",
                    "Comparator of intended movement (from cortex) and actual movement (from proprioceptors)."
                ],
                answer: 3,
                explanation: "Comparator of intended movement (from cortex) and actual movement (from proprioceptors). (Pages 3, 13)"
            },
            {
                question: "Which of the following is NOT a function of the cerebellum?",
                options: [
                    "Providing precise timing for muscle contraction.",
                    "Programming ballistic movements.",
                    "Primary sensory processing for touch.",
                    "Motor learning (shifting movements from conscious to unconscious)."
                ],
                answer: 2,
                explanation: "Primary sensory processing for touch. (Page 3)"
            },
            {
                question: "The vestibulocerebellum primarily controls:",
                options: [
                    "Timing of sequential movements like writing.",
                    "Equilibrium, posture, and muscle tone via input from the vestibular apparatus.",
                    "Coordination of fast ballistic movements of the limbs.",
                    "Planning of voluntary movements."
                ],
                answer: 1,
                explanation: "Equilibrium, posture, and muscle tone via input from the vestibular apparatus. (Page 15)"
            },
            {
                question: "The spinocerebellum receives input from which of the following?",
                options: [
                    "Only from the cerebral cortex.",
                    "Proprioceptors, tactile, visual, and auditory receptors.",
                    "Exclusively from the vestibular nuclei.",
                    "From the limbic system."
                ],
                answer: 1,
                explanation: "Proprioceptors, tactile, visual, and auditory receptors. (Page 15)"
            },
            {
                question: "The corticocerebellum (cerebrocerebellum) is heavily involved in:",
                options: [
                    "Maintaining balance while standing still.",
                    "The timing and planning of fast sequential movements.",
                    "Reflex adjustments of posture.",
                    "Processing olfactory information."
                ],
                answer: 1,
                explanation: "The timing and planning of fast sequential movements. (Page 15)"
            },
            {
                question: "Which function involves the cerebellum preventing overshoot of movements?",
                options: [
                    "Damping function",
                    "Servocomparator function",
                    "Planning of sequential movements",
                    "Control of body equilibrium"
                ],
                answer: 0,
                explanation: "Damping function (Page 16)"
            },
            {
                question: "Dysmetria, as tested by the finger-to-nose test, refers to:",
                options: [
                    "Inability to perform rapid alternating movements.",
                    "Inaccuracy in judging the distance to a target (past-pointing).",
                    "A loss of muscle tone.",
                    "Involuntary rhythmic shaking at rest."
                ],
                answer: 1,
                explanation: "Inaccuracy in judging the distance to a target (past-pointing). (Page 20)"
            },
            {
                question: "The inability to perform rapid, repeated alternating movements like pronation and supination is called:",
                options: [
                    "Dysmetria.",
                    "Ataxia.",
                    "Dysdiadochokinesia.",
                    "Nystagmus."
                ],
                answer: 2,
                explanation: "Dysdiadochokinesia. (Page 20)"
            },
            {
                question: "Nystagmus associated with cerebellar lesions is best described as:",
                options: [
                    "A slow drift of the eyes at rest.",
                    "Rapid, involuntary eye movements (tremor of the eyeball) during fixation.",
                    "Inability to converge the eyes.",
                    "Complete paralysis of lateral gaze."
                ],
                answer: 1,
                explanation: "Rapid, involuntary eye movements (tremor of the eyeball) during fixation. (Page 22)"
            },
            {
                question: "Vertigo, in the context of cerebellar dysfunction, is defined as:",
                options: [
                    "A headache.",
                    "A false sensation of rotation in the absence of actual rotation.",
                    "Blurred vision.",
                    "Ringing in the ears."
                ],
                answer: 1,
                explanation: "A false sensation of rotation in the absence of actual rotation. (Page 22)"
            },
            {
                question: "Motor ataxia is characterized by incoordination due to errors in:",
                options: [
                    "The rate, range, force, and direction of movement.",
                    "Sensory perception only.",
                    "Muscle strength.",
                    "Cognitive understanding of the task."
                ],
                answer: 0,
                explanation: "The rate, range, force, and direction of movement. (Page 19)"
            },
            {
                question: "The 'rebound phenomenon' in cerebellar disease refers to:",
                options: [
                    "An exaggerated patellar reflex.",
                    "The inability to stop a movement promptly, leading to overshoot when resistance is suddenly removed.",
                    "A positive Babinski sign.",
                    "Muscle spasms following a stretch."
                ],
                answer: 1,
                explanation: "The inability to stop a movement promptly, leading to overshoot when resistance is suddenly removed. (Page 18)"
            },
            {
                question: "The finger-to-nose test is primarily used to assess:",
                options: [
                    "Muscle strength.",
                    "Corticospinal tract integrity.",
                    "Sensory acuity.",
                    "Cerebellar function (coordination and dysmetria)."
                ],
                answer: 3,
                explanation: "Cerebellar function (coordination and dysmetria). (Page 17)"
            },
            {
                question: "Sensory ataxia results from a lesion in the:",
                options: [
                    "Cerebellum itself.",
                    "Sensory pathways (e.g., dorsal columns) that provide proprioceptive input to the cerebellum and cortex.",
                    "Primary motor cortex.",
                    "Vestibular nerve."
                ],
                answer: 1,
                explanation: "Sensory pathways (e.g., dorsal columns) that provide proprioceptive input to the cerebellum and cortex. (Page 18)"
            },
            {
                question: "Which of the following is a key difference between spinal proprioceptive pathways to the cerebellum and those to the cortex?",
                options: [
                    "Pathways to the cortex are unconscious, while to the cerebellum are conscious.",
                    "They carry completely different types of sensory information.",
                    "There is no functional difference.",
                    "Pathways to the cerebellum are involved in rapid, automatic adjustments, while to the cortex provide conscious perception."
                ],
                answer: 3,
                explanation: "Pathways to the cerebellum are involved in rapid, automatic adjustments, while to the cortex provide conscious perception. (Page incomplete in source)"
            },
            {
                question: "The cerebellum refines movement patterns by sending correction signals to:",
                options: [
                    "The sensory cortex only.",
                    "The motor cortex and lower motor neurons.",
                    "The basal ganglia only.",
                    "The spinal sensory ganglia."
                ],
                answer: 1,
                explanation: "The motor cortex and lower motor neurons. (Pages 13, 14)"
            },
            {
                question: "Which cerebellar functional division is most involved in coordinating saccadic eye movements?",
                options: [
                    "Vestibulocerebellum",
                    "Spinocerebellum",
                    "Corticocerebellum",
                    "All equally"
                ],
                answer: 1,
                explanation: "Spinocerebellum (Page 15)"
            },
            {
                question: "The emboliform and globose nuclei influence movement via their connection to the red nucleus, which gives rise to the:",
                options: [
                    "Rubrospinal tract (affecting proximal limb muscles).",
                    "Corticospinal tract.",
                    "Vestibulospinal tract.",
                    "Tectospinal tract."
                ],
                answer: 0,
                explanation: "Rubrospinal tract (affecting proximal limb muscles). (Page 12)"
            }
        ];

        // Function to shuffle an array (Fisher-Yates algorithm)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Function to create a randomized version of the quiz data
        function createRandomizedQuizData() {
            const randomizedData = [];
            
            originalQuizData.forEach(question => {
                // Create a copy of the original question
                const randomizedQuestion = {
                    question: question.question,
                    options: [...question.options], // Copy options array
                    originalAnswer: question.answer, // Store original answer index
                    explanation: question.explanation
                };
                
                // Create an array of indices [0, 1, 2, 3]
                const indices = [0, 1, 2, 3];
                
                // Shuffle the indices
                shuffleArray(indices);
                
                // Create a new options array with shuffled order
                const shuffledOptions = indices.map(index => question.options[index]);
                
                // Find the new position of the correct answer
                const newAnswerIndex = indices.indexOf(question.answer);
                
                // Update the question with shuffled options and new answer
                randomizedQuestion.options = shuffledOptions;
                randomizedQuestion.answer = newAnswerIndex;
                
                randomizedData.push(randomizedQuestion);
            });
            
            return randomizedData;
        }

        // Create randomized quiz data
        let quizData = createRandomizedQuizData();

        // Quiz state variables
        let currentQuestion = 0;
        let score = 0;
        let userAnswers = new Array(quizData.length).fill(null);
        let incorrectQuestions = [];

        // DOM elements
        const quizContainer = document.getElementById('quiz-container');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const progressBar = document.getElementById('progress-bar');
        const currentQuestionEl = document.getElementById('current-question');
        const totalQuestionsEl = document.getElementById('total-questions');
        const scoreEl = document.getElementById('score');
        const totalScoreEl = document.getElementById('total-score');
        const resultsContainer = document.getElementById('results');
        const finalScoreEl = document.getElementById('final-score');
        const performanceMessageEl = document.getElementById('performance-message');
        const restartBtn = document.getElementById('restart-btn');
        const reviewBtn = document.getElementById('review-btn');
        const reviewSection = document.getElementById('review-section');
        const incorrectQuestionsList = document.getElementById('incorrect-questions-list');
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const lightText = document.querySelector('.light-text');
        const darkText = document.querySelector('.dark-text');

        // Initialize quiz
        function initQuiz() {
            totalQuestionsEl.textContent = quizData.length;
            totalScoreEl.textContent = quizData.length;
            showQuestion();
            updateProgressBar();
            
            // Initialize dark mode based on system preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.classList.add('dark-mode');
                darkModeToggle.checked = true;
                updateToggleText(true);
            } else {
                updateToggleText(false);
            }
            
            // Event listeners
            prevBtn.addEventListener('click', showPreviousQuestion);
            nextBtn.addEventListener('click', showNextQuestion);
            restartBtn.addEventListener('click', restartQuiz);
            reviewBtn.addEventListener('click', showIncorrectQuestions);
            darkModeToggle.addEventListener('change', toggleDarkMode);
        }

        // Toggle dark mode
        function toggleDarkMode() {
            const isDarkMode = darkModeToggle.checked;
            document.body.classList.toggle('dark-mode', isDarkMode);
            updateToggleText(isDarkMode);
        }

        // Update toggle text opacity
        function updateToggleText(isDarkMode) {
            if (isDarkMode) {
                lightText.style.opacity = '0.5';
                darkText.style.opacity = '1';
            } else {
                lightText.style.opacity = '1';
                darkText.style.opacity = '0.5';
            }
        }

        // Show current question
        function showQuestion() {
            currentQuestionEl.textContent = currentQuestion + 1;
            scoreEl.textContent = score;
            
            const question = quizData[currentQuestion];
            let optionsHTML = '';
            
            question.options.forEach((option, index) => {
                let optionClass = 'option';
                if (userAnswers[currentQuestion] === index) {
                    optionClass += ' selected';
                    if (index === question.answer) {
                        optionClass += ' correct';
                    } else {
                        optionClass += ' incorrect';
                    }
                }
                
                optionsHTML += `
                    <div class="${optionClass}" data-index="${index}">
                        ${String.fromCharCode(65 + index)}) ${option}
                    </div>
                `;
            });
            
            let feedbackHTML = '';
            if (userAnswers[currentQuestion] !== null) {
                const isCorrect = userAnswers[currentQuestion] === question.answer;
                const correctLetter = String.fromCharCode(65 + question.answer);
                const correctAnswerText = question.options[question.answer];
                
                feedbackHTML = `
                    <div class="feedback ${isCorrect ? 'correct' : 'incorrect'}">
                        ${isCorrect ? '✓ Correct!' : '✗ Incorrect!'} 
                        ${!isCorrect ? `Correct answer: ${correctLetter}) ${correctAnswerText}` : ''}
                        <br><br>Explanation: ${question.explanation}
                    </div>
                `;
            }
            
            quizContainer.innerHTML = `
                <div class="question">
                    <div class="question-number">Question ${currentQuestion + 1}/${quizData.length}</div>
                    <div class="question-text">${question.question}</div>
                    <div class="options">${optionsHTML}</div>
                    ${feedbackHTML}
                </div>
            `;
            
            // Add event listeners to options
            const optionElements = quizContainer.querySelectorAll('.option');
            optionElements.forEach(option => {
                option.addEventListener('click', selectOption);
            });
            
            // Update navigation buttons
            prevBtn.disabled = currentQuestion === 0;
            nextBtn.textContent = currentQuestion === quizData.length - 1 ? 'Finish Quiz' : 'Next';
        }

        // Select an option
        function selectOption(e) {
            if (userAnswers[currentQuestion] !== null) return; // Already answered
            
            const selectedOption = e.currentTarget;
            const selectedIndex = parseInt(selectedOption.dataset.index);
            
            userAnswers[currentQuestion] = selectedIndex;
            
            // Check if answer is correct
            if (selectedIndex === quizData[currentQuestion].answer) {
                score++;
                scoreEl.textContent = score;
            } else {
                // Add to incorrect questions list
                incorrectQuestions.push({
                    question: quizData[currentQuestion].question,
                    userAnswer: selectedIndex,
                    correctAnswer: quizData[currentQuestion].answer,
                    options: quizData[currentQuestion].options,
                    explanation: quizData[currentQuestion].explanation,
                    questionNumber: currentQuestion + 1
                });
            }
            
            showQuestion();
            updateProgressBar();
        }

        // Show next question
        function showNextQuestion() {
            if (currentQuestion < quizData.length - 1) {
                currentQuestion++;
                showQuestion();
            } else {
                showResults();
            }
        }

        // Show previous question
        function showPreviousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion();
            }
        }

        // Update progress bar
        function updateProgressBar() {
            const progress = ((currentQuestion + 1) / quizData.length) * 100;
            progressBar.style.width = `${progress}%`;
        }

        // Show results
        function showResults() {
            quizContainer.style.display = 'none';
            document.querySelector('.navigation').style.display = 'none';
            document.querySelector('.progress-container').style.display = 'none';
            document.querySelector('.stats').style.display = 'none';
            
            finalScoreEl.textContent = score;
            
            // Performance message
            const percentage = (score / quizData.length) * 100;
            let message = '';
            if (percentage >= 80) {
                message = 'Excellent! You have a strong understanding of the Cerebellum and Motor Coordination.';
            } else if (percentage >= 60) {
                message = 'Good job! You have a solid grasp of the material.';
            } else if (percentage >= 40) {
                message = 'Not bad! Review the material and try again.';
            } else {
                message = 'Keep studying! Review the lectures and try again.';
            }
            
            performanceMessageEl.textContent = message;
            resultsContainer.style.display = 'block';
            
            // Show review button only if there are incorrect answers
            if (incorrectQuestions.length > 0) {
                reviewBtn.style.display = 'inline-block';
            } else {
                reviewBtn.style.display = 'none';
            }
        }

        // Show incorrect questions
        function showIncorrectQuestions() {
            resultsContainer.style.display = 'none';
            reviewSection.style.display = 'block';
            
            let incorrectHTML = '';
            incorrectQuestions.forEach((item, index) => {
                const correctLetter = String.fromCharCode(65 + item.correctAnswer);
                const userLetter = String.fromCharCode(65 + item.userAnswer);
                
                incorrectHTML += `
                    <div class="review-question">
                        <div class="review-question-number">Question ${item.questionNumber}</div>
                        <div class="review-question-text">${item.question}</div>
                        <div>Your answer: ${userLetter}) ${item.options[item.userAnswer]}</div>
                        <div class="review-answer review-correct">Correct answer: ${correctLetter}) ${item.options[item.correctAnswer]}</div>
                        <div class="review-explanation">${item.explanation}</div>
                    </div>
                `;
            });
            
            incorrectQuestionsList.innerHTML = incorrectHTML;
        }

        // Restart quiz
        function restartQuiz() {
            currentQuestion = 0;
            score = 0;
            userAnswers = new Array(quizData.length).fill(null);
            incorrectQuestions = [];
            
            // Re-randomize the quiz data when restarting
            quizData = createRandomizedQuizData();
            
            quizContainer.style.display = 'block';
            document.querySelector('.navigation').style.display = 'flex';
            document.querySelector('.progress-container').style.display = 'block';
            document.querySelector('.stats').style.display = 'flex';
            resultsContainer.style.display = 'none';
            reviewSection.style.display = 'none';
            
            showQuestion();
            updateProgressBar();
        }

        // Initialize the quiz when the page loads
        window.onload = initQuiz;
    </script>
</body>
</html>