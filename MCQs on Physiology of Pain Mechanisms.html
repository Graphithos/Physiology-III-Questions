<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCQs on Physiology 3 Lecture No. 4 Quiz</title>
    <style>
        :root {
            --bg-color: #f5f7fa;
            --container-bg: white;
            --text-color: #333;
            --border-color: #ddd;
            --primary-color: #3498db;
            --header-color: #2c3e50;
            --secondary-text: #7f8c8d;
            --progress-bg: #ecf0f1;
            --question-bg: #f8f9fa;
            --option-bg: #fff;
            --option-hover: #f1f8ff;
            --option-selected: #d1ecf1;
            --correct-bg: #d4edda;
            --correct-border: #28a745;
            --incorrect-bg: #f8d7da;
            --incorrect-border: #dc3545;
            --button-bg: #3498db;
            --button-hover: #2980b9;
            --button-disabled: #bdc3c7;
            --restart-bg: #2ecc71;
            --restart-hover: #27ae60;
            --review-bg: #f39c12;
            --review-hover: #e67e22;
            --toggle-bg: #ecf0f1;
            --toggle-slider: white;
            --toggle-text: #7f8c8d;
        }

        .dark-mode {
            --bg-color: #1a1a2e;
            --container-bg: #16213e;
            --text-color: #e6e6e6;
            --border-color: #394867;
            --primary-color: #4cc9f0;
            --header-color: #e6e6e6;
            --secondary-text: #a9a9a9;
            --progress-bg: #394867;
            --question-bg: #1f4068;
            --option-bg: #16213e;
            --option-hover: #1f4068;
            --option-selected: #1f4068;
            --correct-bg: #2d5a2d;
            --correct-border: #4caf50;
            --incorrect-bg: #5a2d2d;
            --incorrect-border: #f44336;
            --button-bg: #4cc9f0;
            --button-hover: #3aa8d0;
            --button-disabled: #5d6d7e;
            --restart-bg: #2ecc71;
            --restart-hover: #27ae60;
            --review-bg: #f39c12;
            --review-hover: #e67e22;
            --toggle-bg: #394867;
            --toggle-slider: #4cc9f0;
            --toggle-text: #e6e6e6;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            transition: background-color 0.3s, color 0.3s;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: var(--container-bg);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s, box-shadow 0.3s;
        }
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--primary-color);
            position: relative;
        }
        h1 {
            color: var(--header-color);
            margin-bottom: 5px;
            font-size: 24px;
            transition: color 0.3s;
        }
        .author {
            color: var(--secondary-text);
            font-style: italic;
            margin-bottom: 10px;
            transition: color 0.3s;
        }
        .description {
            color: var(--secondary-text);
            margin-bottom: 20px;
            transition: color 0.3s;
        }
        .theme-toggle {
            position: absolute;
            top: 35px; /* Adjusted to align with author name */
            right: 0;
            display: flex;
            align-items: center;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 120px;
            height: 34px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--toggle-bg);
            transition: .4s;
            border-radius: 34px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
            font-size: 12px;
            font-weight: bold;
            color: var(--toggle-text);
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 60px;
            left: 4px;
            bottom: 4px;
            background-color: var(--toggle-slider);
            transition: .4s;
            border-radius: 34px;
            z-index: 1;
        }
        .slider-text {
            position: relative;
            z-index: 2;
            width: 100%;
            display: flex;
            justify-content: space-between;
        }
        .light-text, .dark-text {
            transition: opacity 0.3s;
        }
        .dark-mode .light-text {
            opacity: 0.5;
        }
        .light-text {
            opacity: 0.5;
        }
        .dark-mode .dark-text {
            opacity: 1;
        }
        .dark-text {
            opacity: 0.5;
        }
        input:checked + .slider:before {
            transform: translateX(52px);
        }
        .progress-container {
            background: var(--progress-bg);
            border-radius: 5px;
            margin-bottom: 20px;
            position: relative;
            height: 10px;
            transition: background-color 0.3s;
        }
        .progress-bar {
            height: 100%;
            background: var(--primary-color);
            border-radius: 5px;
            width: 0%;
            transition: width 0.3s ease, background-color 0.3s;
        }
        .stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-weight: bold;
            color: var(--header-color);
            transition: color 0.3s;
        }
        .question {
            background: var(--question-bg);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: background-color 0.3s;
        }
        .question-number {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
            transition: color 0.3s;
        }
        .question-text {
            font-size: 18px;
            margin-bottom: 15px;
        }
        .options {
            display: grid;
            grid-gap: 10px;
        }
        .option {
            padding: 12px 15px;
            background: var(--option-bg);
            border: 2px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .option:hover {
            background: var(--option-hover);
            border-color: var(--primary-color);
        }
        .option.selected {
            background: var(--option-selected);
            border-color: var(--primary-color);
        }
        .option.correct {
            background: var(--correct-bg);
            border-color: var(--correct-border);
        }
        .option.incorrect {
            background: var(--incorrect-bg);
            border-color: var(--incorrect-border);
        }
        .feedback {
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            display: none;
        }
        .feedback.correct {
            background: var(--correct-bg);
            color: var(--text-color);
            border: 1px solid var(--correct-border);
            display: block;
        }
        .feedback.incorrect {
            background: var(--incorrect-bg);
            color: var(--text-color);
            border: 1px solid var(--incorrect-border);
            display: block;
        }
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        button {
            padding: 10px 20px;
            background: var(--button-bg);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        button:hover {
            background: var(--button-hover);
        }
        button:disabled {
            background: var(--button-disabled);
            cursor: not-allowed;
        }
        .results {
            text-align: center;
            padding: 30px;
            display: none;
        }
        .score {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--header-color);
        }
        .score-value {
            font-size: 48px;
            color: var(--primary-color);
            font-weight: bold;
        }
        .restart-btn {
            margin-top: 20px;
            background: var(--restart-bg);
        }
        .restart-btn:hover {
            background: var(--restart-hover);
        }
        .review-btn {
            margin-top: 20px;
            background: var(--review-bg);
        }
        .review-btn:hover {
            background: var(--review-hover);
        }
        .review-section {
            margin-top: 30px;
            padding: 20px;
            background: var(--question-bg);
            border-radius: 8px;
            display: none;
        }
        .review-title {
            font-size: 20px;
            margin-bottom: 15px;
            color: var(--header-color);
            text-align: center;
        }
        .review-question {
            margin-bottom: 20px;
            padding: 15px;
            border-left: 4px solid var(--incorrect-border);
            background: var(--container-bg);
            border-radius: 4px;
        }
        .review-question-number {
            font-weight: bold;
            color: var(--incorrect-border);
            margin-bottom: 8px;
        }
        .review-question-text {
            margin-bottom: 10px;
        }
        .review-answer {
            margin-top: 8px;
            font-weight: bold;
        }
        .review-correct {
            color: var(--correct-border);
        }
        .review-explanation {
            margin-top: 5px;
            font-style: italic;
            color: var(--secondary-text);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>MCQs on Physiology 3 Lecture No. 4 Quiz</h1>
            <p class="author">Dr. Samy Salem</p>
            <p class="description">Test your knowledge of Physiology 3 Lecture No. 4</p>
            <div class="theme-toggle">
                <label class="switch">
                    <input type="checkbox" id="dark-mode-toggle">
                    <span class="slider">
                        <div class="slider-text">
                            <span class="light-text">Light</span>
                            <span class="dark-text">Dark</span>
                        </div>
                    </span>
                </label>
            </div>
        </header>

        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>

        <div class="stats">
            <div>Question: <span id="current-question">1</span>/<span id="total-questions">40</span></div>
            <div>Score: <span id="score">0</span>/<span id="total-score">40</span></div>
        </div>

        <div id="quiz-container">
            <!-- Questions will be inserted here by JavaScript -->
        </div>

        <div class="navigation">
            <button id="prev-btn" disabled>Previous</button>
            <button id="next-btn">Next</button>
        </div>

        <div id="results" class="results">
            <div class="score">Your Score: <span class="score-value" id="final-score">0</span>/40</div>
            <p id="performance-message"></p>
            <button class="restart-btn" id="restart-btn">Restart Quiz</button>
            <button class="review-btn" id="review-btn">Review Incorrect Answers</button>
        </div>

        <div id="review-section" class="review-section">
            <h2 class="review-title">Questions Answered Incorrectly</h2>
            <div id="incorrect-questions-list"></div>
        </div>
    </div>

    <script>
        // Quiz data (all 40 questions from the PDF)
        const quizData = [
            {
                question: "What is the primary purpose of pain as a sensation?",
                options: [
                    "To provide a pleasurable counter-stimulus",
                    "To enhance muscle strength during injury",
                    "As a protective mechanism to alert consciousness of tissue damage",
                    "To directly initiate the healing process"
                ],
                answer: 2,
                explanation: "As a protective mechanism to alert consciousness of tissue damage (Page 3)"
            },
            {
                question: "Which of the following is a characteristic autonomic reaction to acute pain?",
                options: [
                    "Bradycardia",
                    "Peripheral vasodilation",
                    "Pupil constriction",
                    "Tachycardia"
                ],
                answer: 3,
                explanation: "Tachycardia (Page 3)"
            },
            {
                question: "Pain receptors, or nociceptors, are structurally always:",
                options: [
                    "Encapsulated nerve endings",
                    "Free nerve endings",
                    "Muscle spindles",
                    "Golgi tendon organs"
                ],
                answer: 1,
                explanation: "Free nerve endings (Page 4)"
            },
            {
                question: "Which of the following is NOT a chemical stimulant of nociceptors?",
                options: [
                    "Bradykinin",
                    "Glucose",
                    "Serotonin (5-HT)",
                    "Prostaglandins"
                ],
                answer: 1,
                explanation: "Glucose (Page 4)"
            },
            {
                question: "First-order neurons in the pain pathway can be which fiber types?",
                options: [
                    "Aα and Aβ fibers only",
                    "Aδ and C fibers",
                    "B fibers only",
                    "Ia fibers only"
                ],
                answer: 1,
                explanation: "Aδ and C fibers (Page 6)"
            },
            {
                question: "The second-order neuron for pain ascends to the brain in which tract?",
                options: [
                    "Dorsal column",
                    "Corticospinal tract",
                    "Lateral spino-thalamic tract",
                    "Spinocerebellar tract"
                ],
                answer: 2,
                explanation: "Lateral spino-thalamic tract (Page 6)"
            },
            {
                question: "Where do the fibers for \"fast pain\" primarily terminate for relay to the cortex?",
                options: [
                    "Reticular Formation",
                    "Intralaminar nuclei of the thalamus",
                    "Ventral Posterolateral Nucleus (VPL) of the thalamus",
                    "Substantia Gelatinosa"
                ],
                answer: 2,
                explanation: "Ventral Posterolateral Nucleus (VPL) of the thalamus (Page 6, 7)"
            },
            {
                question: "The neurotransmitter primarily associated with \"slow pain\" transmission by C fibers is:",
                options: [
                    "Substance P",
                    "Acetylcholine",
                    "Glutamate",
                    "Dopamine"
                ],
                answer: 0,
                explanation: "Substance P (Page 7)"
            },
            {
                question: "Full perception of pain, including localization and emotional reaction, requires which level of the nervous system?",
                options: [
                    "Spinal cord",
                    "Thalamus",
                    "Reticular formation",
                    "Cerebral cortex (CTX)"
                ],
                answer: 3,
                explanation: "Cerebral cortex (CTX) (Page 6)"
            },
            {
                question: "The Paleospinothalamic tract, associated with slow pain, mostly terminates in the:",
                options: [
                    "Primary somatosensory cortex",
                    "Reticular formation",
                    "Ventral posterior nucleus of the thalamus",
                    "Cerebellum"
                ],
                answer: 1,
                explanation: "Reticular formation (Page 7)"
            },
            {
                question: "Superficial (cutaneous) pain is characterized by:",
                options: [
                    "Being only a slow, burning sensation",
                    "A rapid phase followed by a slow burning phase",
                    "Poor localization and strong autonomic reactions",
                    "Being transmitted solely by C fibers"
                ],
                answer: 1,
                explanation: "A rapid phase followed by a slow burning phase (Page 9)"
            },
            {
                question: "Deep somatic pain is often associated with:",
                options: [
                    "Precise localization",
                    "Contraction of nearby muscles leading to ischemia",
                    "Lack of autonomic involvement",
                    "Transmission solely by Aδ fibers"
                ],
                answer: 1,
                explanation: "Contraction of nearby muscles leading to ischemia (Page 9)"
            },
            {
                question: "Which of the following is an adequate stimulus for visceral pain?",
                options: [
                    "Precise cutting with a sharp scalpel",
                    "Light touch",
                    "Visceral distension and ischemia",
                    "Vibration"
                ],
                answer: 2,
                explanation: "Visceral distension and ischemia (Page 11)"
            },
            {
                question: "Visceral pain is often poorly localized because:",
                options: [
                    "Visceral organs have no nociceptors",
                    "Receptive fields in viscera are very small",
                    "Receptive fields in viscera are large",
                    "It is only perceived at the thalamic level"
                ],
                answer: 2,
                explanation: "Receptive fields in viscera are large (Page 11)"
            },
            {
                question: "\"Guarding,\" the rigidity of nearby skeletal muscle, is a characteristic associated with:",
                options: [
                    "Superficial pain",
                    "Deep somatic pain",
                    "Referred pain only",
                    "Visceral pain"
                ],
                answer: 3,
                explanation: "Visceral pain (Page 11)"
            },
            {
                question: "Referred pain occurs due to:",
                options: [
                    "Direct damage to sensory nerves in the skin",
                    "Convergence of somatic and visceral afferents on the same spinal segment",
                    "The release of prostaglandins in the brain",
                    "Malfunction of the dorsal column-medial lemniscus pathway"
                ],
                answer: 1,
                explanation: "Convergence of somatic and visceral afferents on the same spinal segment (Page 14)"
            },
            {
                question: "In the mechanism of referred pain, visceral pain fibers synapse in the spinal cord on:",
                options: [
                    "The same second-order neuron that receives signals from the skin",
                    "A dedicated pathway only for visceral sensation",
                    "The dorsal root ganglion cells of somatic nerves",
                    "The corticospinal tract neurons"
                ],
                answer: 0,
                explanation: "The same second-order neuron that receives signals from the skin (Page 15)"
            },
            {
                question: "Headache is defined as:",
                options: [
                    "Pain originating from the brain parenchyma",
                    "Referred pain to the head surface from deep structures",
                    "A primary sensation generated by cranial nerves",
                    "Always caused by intracranial pressure changes"
                ],
                answer: 1,
                explanation: "Referred pain to the head surface from deep structures (Page 17)"
            },
            {
                question: "Which of the following is an example of a headache of intracranial origin?",
                options: [
                    "Muscle spasm headache",
                    "Nasal irritation headache",
                    "Headache of meningitis",
                    "Eye disorder headache"
                ],
                answer: 2,
                explanation: "Headache of meningitis (Page 17)"
            },
            {
                question: "A migraine headache is often attributed to:",
                options: [
                    "Vasospasm of cranial arteries",
                    "Muscle spasm in the neck",
                    "Toxic products from constipation",
                    "Direct irritation of the meninges"
                ],
                answer: 0,
                explanation: "Vasospasm of cranial arteries (Page 17)"
            },
            {
                question: "The \"Gate Control Theory\" of pain suggests that activation of which fibers can inhibit pain?",
                options: [
                    "C fibers",
                    "Aδ fibers",
                    "A-beta fibers",
                    "B fibers"
                ],
                answer: 2,
                explanation: "A-beta fibers (Page 23)"
            },
            {
                question: "Endogenous opioids produced by the body include all of the following EXCEPT:",
                options: [
                    "Endorphins",
                    "Enkephalins",
                    "Dynorphin",
                    "Morphine"
                ],
                answer: 3,
                explanation: "Morphine (Page 22, 30)"
            },
            {
                question: "Presynaptic inhibition of pain afferents in the dorsal horn by opiates works by:",
                options: [
                    "Increasing substance P release",
                    "Blocking the release of substance P",
                    "Directly stimulating C fibers",
                    "Destroying nociceptors"
                ],
                answer: 1,
                explanation: "Blocking the release of substance P (Page 30)"
            },
            {
                question: "A key nucleus in the medulla that receives input from the midbrain and projects down to inhibit pain in the spinal cord is the:",
                options: [
                    "Red nucleus",
                    "Raphe magnus nucleus",
                    "Inferior olivary nucleus",
                    "Dentate nucleus"
                ],
                answer: 1,
                explanation: "Raphe magnus nucleus (Page 29, 30)"
            },
            {
                question: "Stress-induced analgesia can be inhibited by naloxone because:",
                options: [
                    "Naloxone is a prostaglandin inhibitor",
                    "Naloxone blocks substance P receptors",
                    "Naloxone enhances glutamate action",
                    "Naloxone is an opiate receptor antagonist"
                ],
                answer: 3,
                explanation: "Naloxone is an opiate receptor antagonist (Page 31)"
            },
            {
                question: "Acupuncture applied away from the site of pain is thought to act primarily by:",
                options: [
                    "Stimulating Aδ fibers",
                    "Causing local tissue damage",
                    "Releasing endorphins",
                    "Blocking all sensory input"
                ],
                answer: 2,
                explanation: "Releasing endorphins (Page 31)"
            },
            {
                question: "The use of anti-spasmodics would be most appropriate for treating pain associated with:",
                options: [
                    "Migraine headaches",
                    "Muscle ischemia",
                    "Intestinal or ureteral colics",
                    "Superficial burns"
                ],
                answer: 2,
                explanation: "Intestinal or ureteral colics (Page 33)"
            },
            {
                question: "Stimulation of the midbrain periaqueductal gray matter leads to:",
                options: [
                    "Increased pain perception",
                    "Activation of the descending pain inhibitory pathway",
                    "Direct stimulation of nociceptors",
                    "Blockade of the dorsal columns"
                ],
                answer: 1,
                explanation: "Activation of the descending pain inhibitory pathway (Page 29, 30, 33)"
            },
            {
                question: "A condition where a minor stimulus leads to an exaggerated pain response is called:",
                options: [
                    "Hypoalgesia",
                    "Analgesia",
                    "Hyperalgesia",
                    "Paresthesia"
                ],
                answer: 2,
                explanation: "Hyperalgesia (Page 34)"
            },
            {
                question: "The perception of pain from a non-painful stimulus like light touch is known as:",
                options: [
                    "Causalgia",
                    "Allodynia",
                    "Hypoalgemia",
                    "Hyperesthesia"
                ],
                answer: 1,
                explanation: "Allodynia (Page 34)"
            },
            {
                question: "A spontaneous burning pain often following a minor injury, associated with hyperalgesia and allodynia, is called:",
                options: [
                    "Causalgia",
                    "Paresthesia",
                    "Anesthesia",
                    "Hypoalgesia"
                ],
                answer: 0,
                explanation: "Causalgia (Page 34)"
            },
            {
                question: "A complete loss of touch sensation is termed:",
                options: [
                    "Analgesia",
                    "Anesthesia",
                    "Hypoalgesia",
                    "Paresthesia"
                ],
                answer: 1,
                explanation: "Anesthesia (Page 34)"
            },
            {
                question: "The abnormal sensation of \"insect crawling on skin\" or numbness is called:",
                options: [
                    "Hyperesthesia",
                    "Causalgia",
                    "Allodynia",
                    "Paresthesia"
                ],
                answer: 3,
                explanation: "Paresthesia (Page 34)"
            },
            {
                question: "Which neurotransmitter is described as a major excitatory neurotransmitter involved in pain pathways?",
                options: [
                    "GABA",
                    "Glycine",
                    "Glutamate",
                    "Serotonin"
                ],
                answer: 2,
                explanation: "Glutamate (Page 22)"
            },
            {
                question: "The periaqueductal gray area and the raphe magnus nucleus are key components of the:",
                options: [
                    "Ascending pain pathway",
                    "Visual pathway",
                    "Descending pain inhibitory pathway",
                    "Limbic system for emotion"
                ],
                answer: 2,
                explanation: "Descending pain inhibitory pathway (Page 29, 30)"
            },
            {
                question: "The neurotransmitter released by raphe magnus nucleus fibers that activates inhibitory interneurons in the spinal cord is:",
                options: [
                    "Serotonin (5-HT)",
                    "Substance P",
                    "Glutamate",
                    "Acetylcholine"
                ],
                answer: 0,
                explanation: "Serotonin (5-HT) (Page 29, 30)"
            },
            {
                question: "Irritation of the skin over an injured visceral organ can relieve pain due to:",
                options: [
                    "The Gate Control Theory",
                    "Causing referred pain",
                    "Destroying the visceral afferents",
                    "Increasing visceral blood flow"
                ],
                answer: 0,
                explanation: "The Gate Control Theory (Page 21, 23)"
            },
            {
                question: "Which statement accurately describes visceral afferent nerves?",
                options: [
                    "Their cell bodies are located in the ventral horn of the spinal cord.",
                    "They run with sympathetic and parasympathetic nerves.",
                    "They synapse in autonomic ganglia before entering the CNS.",
                    "They are responsible for voluntary motor control of organs."
                ],
                answer: 1,
                explanation: "They run with sympathetic and parasympathetic nerves. (Page 12)"
            },
            {
                question: "A key difference between somatic and visceral sensation is that visceral sensation is:",
                options: [
                    "Always conscious and well-localized",
                    "Only perceived as referred pain",
                    "Transmitted exclusively by Aδ fibers",
                    "Often unconscious; if conscious, it is dull and poorly-localized"
                ],
                answer: 3,
                explanation: "Often unconscious; if conscious, it is dull and poorly-localized (Page 13)"
            },
            {
                question: "The \"P-factor\" released during muscle contraction, potentially causing pain like in angina, is thought to be:",
                options: [
                    "Serotonin",
                    "Histamine",
                    "Potassium ions (K+)",
                    "Acetylcholine"
                ],
                answer: 2,
                explanation: "Potassium ions (K+) (Page 10)"
            }
        ];

        // Quiz state variables
        let currentQuestion = 0;
        let score = 0;
        let userAnswers = new Array(quizData.length).fill(null);
        let incorrectQuestions = [];

        // DOM elements
        const quizContainer = document.getElementById('quiz-container');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const progressBar = document.getElementById('progress-bar');
        const currentQuestionEl = document.getElementById('current-question');
        const totalQuestionsEl = document.getElementById('total-questions');
        const scoreEl = document.getElementById('score');
        const totalScoreEl = document.getElementById('total-score');
        const resultsContainer = document.getElementById('results');
        const finalScoreEl = document.getElementById('final-score');
        const performanceMessageEl = document.getElementById('performance-message');
        const restartBtn = document.getElementById('restart-btn');
        const reviewBtn = document.getElementById('review-btn');
        const reviewSection = document.getElementById('review-section');
        const incorrectQuestionsList = document.getElementById('incorrect-questions-list');
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const lightText = document.querySelector('.light-text');
        const darkText = document.querySelector('.dark-text');

        // Initialize quiz
        function initQuiz() {
            totalQuestionsEl.textContent = quizData.length;
            totalScoreEl.textContent = quizData.length;
            showQuestion();
            updateProgressBar();
            
            // Initialize dark mode based on system preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.classList.add('dark-mode');
                darkModeToggle.checked = true;
                updateToggleText(true);
            } else {
                updateToggleText(false);
            }
            
            // Event listeners
            prevBtn.addEventListener('click', showPreviousQuestion);
            nextBtn.addEventListener('click', showNextQuestion);
            restartBtn.addEventListener('click', restartQuiz);
            reviewBtn.addEventListener('click', showIncorrectQuestions);
            darkModeToggle.addEventListener('change', toggleDarkMode);
        }

        // Toggle dark mode
        function toggleDarkMode() {
            const isDarkMode = darkModeToggle.checked;
            document.body.classList.toggle('dark-mode', isDarkMode);
            updateToggleText(isDarkMode);
        }

        // Update toggle text opacity
        function updateToggleText(isDarkMode) {
            if (isDarkMode) {
                lightText.style.opacity = '0.5';
                darkText.style.opacity = '1';
            } else {
                lightText.style.opacity = '1';
                darkText.style.opacity = '0.5';
            }
        }

        // Show current question
        function showQuestion() {
            currentQuestionEl.textContent = currentQuestion + 1;
            scoreEl.textContent = score;
            
            const question = quizData[currentQuestion];
            let optionsHTML = '';
            
            question.options.forEach((option, index) => {
                let optionClass = 'option';
                if (userAnswers[currentQuestion] === index) {
                    optionClass += ' selected';
                    if (index === question.answer) {
                        optionClass += ' correct';
                    } else {
                        optionClass += ' incorrect';
                    }
                }
                
                optionsHTML += `
                    <div class="${optionClass}" data-index="${index}">
                        ${String.fromCharCode(65 + index)}) ${option}
                    </div>
                `;
            });
            
            let feedbackHTML = '';
            if (userAnswers[currentQuestion] !== null) {
                const isCorrect = userAnswers[currentQuestion] === question.answer;
                feedbackHTML = `
                    <div class="feedback ${isCorrect ? 'correct' : 'incorrect'}">
                        ${isCorrect ? '✓ Correct!' : '✗ Incorrect!'} 
                        ${!isCorrect ? `Correct answer: ${String.fromCharCode(65 + question.answer)}) ${question.options[question.answer]}` : ''}
                        <br><br>Explanation: ${question.explanation}
                    </div>
                `;
            }
            
            quizContainer.innerHTML = `
                <div class="question">
                    <div class="question-number">Question ${currentQuestion + 1}/${quizData.length}</div>
                    <div class="question-text">${question.question}</div>
                    <div class="options">${optionsHTML}</div>
                    ${feedbackHTML}
                </div>
            `;
            
            // Add event listeners to options
            const optionElements = quizContainer.querySelectorAll('.option');
            optionElements.forEach(option => {
                option.addEventListener('click', selectOption);
            });
            
            // Update navigation buttons
            prevBtn.disabled = currentQuestion === 0;
            nextBtn.textContent = currentQuestion === quizData.length - 1 ? 'Finish Quiz' : 'Next';
        }

        // Select an option
        function selectOption(e) {
            if (userAnswers[currentQuestion] !== null) return; // Already answered
            
            const selectedOption = e.currentTarget;
            const selectedIndex = parseInt(selectedOption.dataset.index);
            
            userAnswers[currentQuestion] = selectedIndex;
            
            // Check if answer is correct
            if (selectedIndex === quizData[currentQuestion].answer) {
                score++;
                scoreEl.textContent = score;
            } else {
                // Add to incorrect questions list
                incorrectQuestions.push({
                    question: quizData[currentQuestion].question,
                    userAnswer: selectedIndex,
                    correctAnswer: quizData[currentQuestion].answer,
                    options: quizData[currentQuestion].options,
                    explanation: quizData[currentQuestion].explanation,
                    questionNumber: currentQuestion + 1
                });
            }
            
            showQuestion();
            updateProgressBar();
        }

        // Show next question
        function showNextQuestion() {
            if (currentQuestion < quizData.length - 1) {
                currentQuestion++;
                showQuestion();
            } else {
                showResults();
            }
        }

        // Show previous question
        function showPreviousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion();
            }
        }

        // Update progress bar
        function updateProgressBar() {
            const progress = ((currentQuestion + 1) / quizData.length) * 100;
            progressBar.style.width = `${progress}%`;
        }

        // Show results
        function showResults() {
            quizContainer.style.display = 'none';
            document.querySelector('.navigation').style.display = 'none';
            document.querySelector('.progress-container').style.display = 'none';
            document.querySelector('.stats').style.display = 'none';
            
            finalScoreEl.textContent = score;
            
            // Performance message
            const percentage = (score / quizData.length) * 100;
            let message = '';
            if (percentage >= 80) {
                message = 'Excellent! You have a strong understanding of Physiology 3 Lecture No. 4.';
            } else if (percentage >= 60) {
                message = 'Good job! You have a solid grasp of the material.';
            } else if (percentage >= 40) {
                message = 'Not bad! Review the material and try again.';
            } else {
                message = 'Keep studying! Review the lectures and try again.';
            }
            
            performanceMessageEl.textContent = message;
            resultsContainer.style.display = 'block';
            
            // Show review button only if there are incorrect answers
            if (incorrectQuestions.length > 0) {
                reviewBtn.style.display = 'inline-block';
            } else {
                reviewBtn.style.display = 'none';
            }
        }

        // Show incorrect questions
        function showIncorrectQuestions() {
            resultsContainer.style.display = 'none';
            reviewSection.style.display = 'block';
            
            let incorrectHTML = '';
            incorrectQuestions.forEach((item, index) => {
                incorrectHTML += `
                    <div class="review-question">
                        <div class="review-question-number">Question ${item.questionNumber}</div>
                        <div class="review-question-text">${item.question}</div>
                        <div>Your answer: ${String.fromCharCode(65 + item.userAnswer)}) ${item.options[item.userAnswer]}</div>
                        <div class="review-answer review-correct">Correct answer: ${String.fromCharCode(65 + item.correctAnswer)}) ${item.options[item.correctAnswer]}</div>
                        <div class="review-explanation">${item.explanation}</div>
                    </div>
                `;
            });
            
            incorrectQuestionsList.innerHTML = incorrectHTML;
        }

        // Restart quiz
        function restartQuiz() {
            currentQuestion = 0;
            score = 0;
            userAnswers = new Array(quizData.length).fill(null);
            incorrectQuestions = [];
            
            quizContainer.style.display = 'block';
            document.querySelector('.navigation').style.display = 'flex';
            document.querySelector('.progress-container').style.display = 'block';
            document.querySelector('.stats').style.display = 'flex';
            resultsContainer.style.display = 'none';
            reviewSection.style.display = 'none';
            
            showQuestion();
            updateProgressBar();
        }

        // Initialize the quiz when the page loads
        window.onload = initQuiz;
    </script>
</body>
</html>