<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCQs on Physiology 3 Lecture No. 10 Quiz</title>
    <style>
        :root {
            --bg-color: #f5f7fa;
            --container-bg: white;
            --text-color: #333;
            --border-color: #ddd;
            --primary-color: #3498db;
            --header-color: #2c3e50;
            --secondary-text: #7f8c8d;
            --progress-bg: #ecf0f1;
            --question-bg: #f8f9fa;
            --option-bg: #fff;
            --option-hover: #f1f8ff;
            --option-selected: #d1ecf1;
            --correct-bg: #d4edda;
            --correct-border: #28a745;
            --incorrect-bg: #f8d7da;
            --incorrect-border: #dc3545;
            --button-bg: #3498db;
            --button-hover: #2980b9;
            --button-disabled: #bdc3c7;
            --restart-bg: #2ecc71;
            --restart-hover: #27ae60;
            --review-bg: #f39c12;
            --review-hover: #e67e22;
            --toggle-bg: #ecf0f1;
            --toggle-slider: white;
            --toggle-text: #7f8c8d;
        }

        .dark-mode {
            --bg-color: #1a1a2e;
            --container-bg: #16213e;
            --text-color: #e6e6e6;
            --border-color: #394867;
            --primary-color: #4cc9f0;
            --header-color: #e6e6e6;
            --secondary-text: #a9a9a9;
            --progress-bg: #394867;
            --question-bg: #1f4068;
            --option-bg: #16213e;
            --option-hover: #1f4068;
            --option-selected: #1f4068;
            --correct-bg: #2d5a2d;
            --correct-border: #4caf50;
            --incorrect-bg: #5a2d2d;
            --incorrect-border: #f44336;
            --button-bg: #4cc9f0;
            --button-hover: #3aa8d0;
            --button-disabled: #5d6d7e;
            --restart-bg: #2ecc71;
            --restart-hover: #27ae60;
            --review-bg: #f39c12;
            --review-hover: #e67e22;
            --toggle-bg: #394867;
            --toggle-slider: #4cc9f0;
            --toggle-text: #e6e6e6;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            transition: background-color 0.3s, color 0.3s;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: var(--container-bg);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s, box-shadow 0.3s;
        }
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--primary-color);
            position: relative;
        }
        h1 {
            color: var(--header-color);
            margin-bottom: 5px;
            font-size: 24px;
            transition: color 0.3s;
        }
        .author {
            color: var(--secondary-text);
            font-style: italic;
            margin-bottom: 10px;
            transition: color 0.3s;
        }
        .description {
            color: var(--secondary-text);
            margin-bottom: 20px;
            transition: color 0.3s;
        }
        .theme-toggle {
            position: absolute;
            top: 35px;
            right: 0;
            display: flex;
            align-items: center;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 120px;
            height: 34px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--toggle-bg);
            transition: .4s;
            border-radius: 34px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
            font-size: 12px;
            font-weight: bold;
            color: var(--toggle-text);
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 60px;
            left: 4px;
            bottom: 4px;
            background-color: var(--toggle-slider);
            transition: .4s;
            border-radius: 34px;
            z-index: 1;
        }
        .slider-text {
            position: relative;
            z-index: 2;
            width: 100%;
            display: flex;
            justify-content: space-between;
        }
        .light-text, .dark-text {
            transition: opacity 0.3s;
        }
        .dark-mode .light-text {
            opacity: 0.5;
        }
        .light-text {
            opacity: 0.5;
        }
        .dark-mode .dark-text {
            opacity: 1;
        }
        .dark-text {
            opacity: 0.5;
        }
        input:checked + .slider:before {
            transform: translateX(52px);
        }
        .progress-container {
            background: var(--progress-bg);
            border-radius: 5px;
            margin-bottom: 20px;
            position: relative;
            height: 10px;
            transition: background-color 0.3s;
        }
        .progress-bar {
            height: 100%;
            background: var(--primary-color);
            border-radius: 5px;
            width: 0%;
            transition: width 0.3s ease, background-color 0.3s;
        }
        .stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-weight: bold;
            color: var(--header-color);
            transition: color 0.3s;
        }
        .question {
            background: var(--question-bg);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: background-color 0.3s;
        }
        .question-number {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
            transition: color 0.3s;
        }
        .question-text {
            font-size: 18px;
            margin-bottom: 15px;
        }
        .options {
            display: grid;
            grid-gap: 10px;
        }
        .option {
            padding: 12px 15px;
            background: var(--option-bg);
            border: 2px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .option:hover {
            background: var(--option-hover);
            border-color: var(--primary-color);
        }
        .option.selected {
            background: var(--option-selected);
            border-color: var(--primary-color);
        }
        .option.correct {
            background: var(--correct-bg);
            border-color: var(--correct-border);
        }
        .option.incorrect {
            background: var(--incorrect-bg);
            border-color: var(--incorrect-border);
        }
        .feedback {
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            display: none;
        }
        .feedback.correct {
            background: var(--correct-bg);
            color: var(--text-color);
            border: 1px solid var(--correct-border);
            display: block;
        }
        .feedback.incorrect {
            background: var(--incorrect-bg);
            color: var(--text-color);
            border: 1px solid var(--incorrect-border);
            display: block;
        }
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        button {
            padding: 10px 20px;
            background: var(--button-bg);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        button:hover {
            background: var(--button-hover);
        }
        button:disabled {
            background: var(--button-disabled);
            cursor: not-allowed;
        }
        .results {
            text-align: center;
            padding: 30px;
            display: none;
        }
        .score {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--header-color);
        }
        .score-value {
            font-size: 48px;
            color: var(--primary-color);
            font-weight: bold;
        }
        .restart-btn {
            margin-top: 20px;
            background: var(--restart-bg);
        }
        .restart-btn:hover {
            background: var(--restart-hover);
        }
        .review-btn {
            margin-top: 20px;
            background: var(--review-bg);
        }
        .review-btn:hover {
            background: var(--review-hover);
        }
        .review-section {
            margin-top: 30px;
            padding: 20px;
            background: var(--question-bg);
            border-radius: 8px;
            display: none;
        }
        .review-title {
            font-size: 20px;
            margin-bottom: 15px;
            color: var(--header-color);
            text-align: center;
        }
        .review-question {
            margin-bottom: 20px;
            padding: 15px;
            border-left: 4px solid var(--incorrect-border);
            background: var(--container-bg);
            border-radius: 4px;
        }
        .review-question-number {
            font-weight: bold;
            color: var(--incorrect-border);
            margin-bottom: 8px;
        }
        .review-question-text {
            margin-bottom: 10px;
        }
        .review-answer {
            margin-top: 8px;
            font-weight: bold;
        }
        .review-correct {
            color: var(--correct-border);
        }
        .review-explanation {
            margin-top: 5px;
            font-style: italic;
            color: var(--secondary-text);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>MCQs on Physiology 3 Lecture No. 10 Quiz</h1>
            <p class="author">Dr. Samy Salem</p>
            <p class="description">Test your knowledge of Visual System and Eye Physiology</p>
            <div class="theme-toggle">
                <label class="switch">
                    <input type="checkbox" id="dark-mode-toggle">
                    <span class="slider">
                        <div class="slider-text">
                            <span class="light-text">Light</span>
                            <span class="dark-text">Dark</span>
                        </div>
                    </span>
                </label>
            </div>
        </header>

        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>

        <div class="stats">
            <div>Question: <span id="current-question">1</span>/<span id="total-questions">30</span></div>
            <div>Score: <span id="score">0</span>/<span id="total-score">30</span></div>
        </div>

        <div id="quiz-container">
            <!-- Questions will be inserted here by JavaScript -->
        </div>

        <div class="navigation">
            <button id="prev-btn" disabled>Previous</button>
            <button id="next-btn">Next</button>
        </div>

        <div id="results" class="results">
            <div class="score">Your Score: <span class="score-value" id="final-score">0</span>/30</div>
            <p id="performance-message"></p>
            <button class="restart-btn" id="restart-btn">Restart Quiz</button>
            <button class="review-btn" id="review-btn">Review Incorrect Answers</button>
        </div>

        <div id="review-section" class="review-section">
            <h2 class="review-title">Questions Answered Incorrectly</h2>
            <div id="incorrect-questions-list"></div>
        </div>
    </div>

    <script>
        // Quiz data from Physiology 3 Lecture No. 10
        const originalQuizData = [
            {
                question: "The outer coat of the eye includes the cornea. What is a characteristic of the cornea?",
                options: [
                    "It is highly vascular.",
                    "It is avascular.",
                    "It contains melanin pigment.",
                    "It is responsible for accommodation."
                ],
                answer: 1,
                explanation: "It is avascular. (Page 3)"
            },
            {
                question: "The primary function of the cornea is:",
                options: [
                    "To change shape for focusing.",
                    "To absorb stray light.",
                    "To act as a refractive medium and provide protection.",
                    "To produce aqueous humor."
                ],
                answer: 2,
                explanation: "To act as a refractive medium and provide protection. (Page 3)"
            },
            {
                question: "Which part of the middle coat is responsible for accommodation (changing lens shape)?",
                options: [
                    "Choroid",
                    "Ciliary body",
                    "Iris",
                    "Sclera"
                ],
                answer: 1,
                explanation: "Ciliary body (Page 4)"
            },
            {
                question: "The iris regulates the amount of light entering the eye. Pupils constrict in which condition?",
                options: [
                    "Distant vision and dim light",
                    "Close vision and bright light",
                    "During problem-solving",
                    "During sleep"
                ],
                answer: 1,
                explanation: "Close vision and bright light (Page 6)"
            },
            {
                question: "The 'far point of vision' is defined as the distance beyond which the lens does not need to change shape to focus. This distance is approximately:",
                options: [
                    "5 feet",
                    "10 feet",
                    "20 feet",
                    "50 feet"
                ],
                answer: 2,
                explanation: "20 feet (Page 8)"
            },
            {
                question: "When light passes through a convex lens (like the eye's lens), the image formed on the retina is:",
                options: [
                    "Upside down and reversed right to left.",
                    "Upright and reversed left to right.",
                    "Upright and magnified.",
                    "Blurred and inverted."
                ],
                answer: 0,
                explanation: "Upside down and reversed right to left. (Page 7)"
            },
            {
                question: "For close vision, the lens must become:",
                options: [
                    "Flattened",
                    "More convex (bulges)",
                    "More concave",
                    "Dislocated"
                ],
                answer: 1,
                explanation: "More convex (bulges) (Page 9)"
            },
            {
                question: "Which of the following is NOT a component of the 'near triad' for close vision?",
                options: [
                    "Accommodation (lens shape change)",
                    "Pupillary constriction",
                    "Convergence of the eyes",
                    "Pupillary dilation"
                ],
                answer: 3,
                explanation: "Pupillary dilation (Page 10)"
            },
            {
                question: "The pigment epithelium of the retina performs all of the following functions EXCEPT:",
                options: [
                    "Absorbing stray light rays.",
                    "Storing vitamin A.",
                    "Phagocytosing old photoreceptor discs.",
                    "Generating action potentials in response to light."
                ],
                answer: 3,
                explanation: "Generating action potentials in response to light. (Page 14)"
            },
            {
                question: "Which photoreceptor is more numerous in the human retina?",
                options: [
                    "Cones",
                    "Rods",
                    "Bipolar cells",
                    "Ganglion cells"
                ],
                answer: 1,
                explanation: "Rods (Page 15)"
            },
            {
                question: "Rods are characterized by:",
                options: [
                    "High visual acuity and color vision.",
                    "Low light sensitivity and high threshold.",
                    "High light sensitivity (scotopic vision) and the pigment rhodopsin.",
                    "Concentrated distribution in the fovea."
                ],
                answer: 2,
                explanation: "High light sensitivity (scotopic vision) and the pigment rhodopsin. (Page 15)"
            },
            {
                question: "Cones are responsible for:",
                options: [
                    "Scotopic (night) vision only.",
                    "Photopic (day) and color vision.",
                    "Peripheral vision only.",
                    "Detecting movement in dim light."
                ],
                answer: 1,
                explanation: "Photopic (day) and color vision. (Page 16)"
            },
            {
                question: "In the retina, signals from photoreceptors (rods and cones) are transmitted directly to:",
                options: [
                    "Ganglion cells",
                    "Horizontal cells",
                    "Bipolar cells",
                    "Optic nerve fibers"
                ],
                answer: 2,
                explanation: "Bipolar cells (Page 17)"
            },
            {
                question: "Which type of ganglion cell is most numerous and transmits cone vision, terminating at P cells of the Lateral Geniculate Body (LGB)?",
                options: [
                    "W cells",
                    "X cells",
                    "Y cells",
                    "Z cells"
                ],
                answer: 1,
                explanation: "X cells (Page 18)"
            },
            {
                question: "The fovea centralis is specialized for high visual acuity because it has:",
                options: [
                    "A high density of rods and significant convergence.",
                    "No photoreceptors.",
                    "A high density of cones, with each cone often connected to a single bipolar/ganglion cell.",
                    "Numerous blood vessels for nourishment."
                ],
                answer: 2,
                explanation: "A high density of cones, with each cone often connected to a single bipolar/ganglion cell. (Page 20)"
            },
            {
                question: "The optic nerve is best described as:",
                options: [
                    "A typical peripheral nerve capable of regeneration.",
                    "A tract of the central nervous system connecting the retina to the brain.",
                    "Containing only crossed fibers.",
                    "Having over 10 million fibers."
                ],
                answer: 1,
                explanation: "A tract of the central nervous system connecting the retina to the brain. (Page 24)"
            },
            {
                question: "At the optic chiasm, which fibers cross to the contralateral side?",
                options: [
                    "Nasal retinal fibers from both eyes",
                    "Temporal retinal fibers from both eyes",
                    "All fibers from the left eye",
                    "All fibers from the right eye"
                ],
                answer: 0,
                explanation: "Nasal retinal fibers from both eyes (Page 25)"
            },
            {
                question: "The optic tract contains fibers from:",
                options: [
                    "The temporal retina of the ipsilateral eye and the nasal retina of the contralateral eye.",
                    "The nasal retina of the ipsilateral eye and the temporal retina of the contralateral eye.",
                    "Only the ipsilateral eye.",
                    "Only the contralateral eye."
                ],
                answer: 0,
                explanation: "The temporal retina of the ipsilateral eye and the nasal retina of the contralateral eye. (Page 26)"
            },
            {
                question: "Visual fibers from the optic tract terminate and synapse in the:",
                options: [
                    "Superior colliculus",
                    "Lateral Geniculate Body (LGB) of the thalamus",
                    "Primary visual cortex (Area 17)",
                    "Medial Geniculate Body"
                ],
                answer: 1,
                explanation: "Lateral Geniculate Body (LGB) of the thalamus (Page 26)"
            },
            {
                question: "The axons from the LGB to the visual cortex form the:",
                options: [
                    "Optic chiasm",
                    "Optic radiation (geniculocalcarine tract)",
                    "Optic tract",
                    "Corticobulbar tract"
                ],
                answer: 1,
                explanation: "Optic radiation (geniculocalcarine tract) (Page 28)"
            },
            {
                question: "The primary visual cortex is located in the:",
                options: [
                    "Frontal lobe",
                    "Parietal lobe",
                    "Temporal lobe",
                    "Occipital lobe (Area 17)"
                ],
                answer: 3,
                explanation: "Occipital lobe (Area 17) (Pages 29, 31)"
            },
            {
                question: "Area 17 (primary visual cortex) is primarily responsible for:",
                options: [
                    "Recognizing objects and interpreting their meaning.",
                    "Controlling eye movements.",
                    "Associating visual images with memory.",
                    "Perception of visual sensations (light, form, color) and fusion of images."
                ],
                answer: 3,
                explanation: "Perception of visual sensations (light, form, color) and fusion of images. (Page 31)"
            },
            {
                question: "Damage to Area 18 (visuopsychic area) could lead to:",
                options: [
                    "Complete blindness.",
                    "Visual aphasia (inability to understand written words or recognize objects).",
                    "Loss of pupillary light reflex.",
                    "Inability to move the eyes."
                ],
                answer: 1,
                explanation: "Visual aphasia (inability to understand written words or recognize objects). (Page 32)"
            },
            {
                question: "Area 19 is involved in which of the following motor functions?",
                options: [
                    "Conjugate deviation of both eyes and fixation",
                    "Primary motor part for accommodation of the lens",
                    "Pupillary constriction",
                    "Eyelid closure"
                ],
                answer: 0,
                explanation: "Conjugate deviation of both eyes and fixation (Page 33)"
            },
            {
                question: "Which area sends information to the frontal eye field (Area 8) during accommodation?",
                options: [
                    "Area 17",
                    "Area 18",
                    "Area 19",
                    "Area 4"
                ],
                answer: 2,
                explanation: "Area 19 (Page 33)"
            },
            {
                question: "A lesion of the left optic nerve would cause:",
                options: [
                    "Blindness in the temporal visual field of the left eye.",
                    "Blindness in the nasal visual field of the left eye.",
                    "Complete blindness in the left eye.",
                    "Bitemporal hemianopia."
                ],
                answer: 2,
                explanation: "Complete blindness in the left eye. (Optic nerve carries all info from one eye) (Page information implied)"
            },
            {
                question: "Bipolar cells in the retina can be:",
                options: [
                    "Only depolarizing.",
                    "Only hyperpolarizing.",
                    "Either depolarizing or hyperpolarizing in response to light.",
                    "Unresponsive to light."
                ],
                answer: 2,
                explanation: "Either depolarizing or hyperpolarizing in response to light. (Page 17)"
            },
            {
                question: "Which retinal cells transmit signals from bipolar and amacrine cells to the brain via their axons?",
                options: [
                    "Horizontal cells",
                    "Photoreceptors",
                    "Ganglion cells",
                    "Pigment epithelial cells"
                ],
                answer: 2,
                explanation: "Ganglion cells (Page 18)"
            },
            {
                question: "The pigment found in rod photoreceptors is:",
                options: [
                    "Iodopsin",
                    "Melanopsin",
                    "Photopsin",
                    "Rhodopsin"
                ],
                answer: 3,
                explanation: "Rhodopsin (Page 15, implied from earlier question)"
            },
            {
                question: "Convergence in retinal circuitry is most pronounced for which type of photoreceptor?",
                options: [
                    "Rods",
                    "Cones, especially in the fovea",
                    "Both equally",
                    "Neither; there is no convergence."
                ],
                answer: 0,
                explanation: "Rods (Page 15)"
            }
        ];

        // Function to shuffle an array (Fisher-Yates algorithm)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Function to create a randomized version of the quiz data
        function createRandomizedQuizData() {
            const randomizedData = [];
            
            originalQuizData.forEach(question => {
                // Create a copy of the original question
                const randomizedQuestion = {
                    question: question.question,
                    options: [...question.options], // Copy options array
                    originalAnswer: question.answer, // Store original answer index
                    explanation: question.explanation
                };
                
                // Create an array of indices [0, 1, 2, 3]
                const indices = [0, 1, 2, 3];
                
                // Shuffle the indices
                shuffleArray(indices);
                
                // Create a new options array with shuffled order
                const shuffledOptions = indices.map(index => question.options[index]);
                
                // Find the new position of the correct answer
                const newAnswerIndex = indices.indexOf(question.answer);
                
                // Update the question with shuffled options and new answer
                randomizedQuestion.options = shuffledOptions;
                randomizedQuestion.answer = newAnswerIndex;
                
                randomizedData.push(randomizedQuestion);
            });
            
            return randomizedData;
        }

        // Create randomized quiz data
        let quizData = createRandomizedQuizData();

        // Quiz state variables
        let currentQuestion = 0;
        let score = 0;
        let userAnswers = new Array(quizData.length).fill(null);
        let incorrectQuestions = [];

        // DOM elements
        const quizContainer = document.getElementById('quiz-container');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const progressBar = document.getElementById('progress-bar');
        const currentQuestionEl = document.getElementById('current-question');
        const totalQuestionsEl = document.getElementById('total-questions');
        const scoreEl = document.getElementById('score');
        const totalScoreEl = document.getElementById('total-score');
        const resultsContainer = document.getElementById('results');
        const finalScoreEl = document.getElementById('final-score');
        const performanceMessageEl = document.getElementById('performance-message');
        const restartBtn = document.getElementById('restart-btn');
        const reviewBtn = document.getElementById('review-btn');
        const reviewSection = document.getElementById('review-section');
        const incorrectQuestionsList = document.getElementById('incorrect-questions-list');
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const lightText = document.querySelector('.light-text');
        const darkText = document.querySelector('.dark-text');

        // Initialize quiz
        function initQuiz() {
            totalQuestionsEl.textContent = quizData.length;
            totalScoreEl.textContent = quizData.length;
            showQuestion();
            updateProgressBar();
            
            // Initialize dark mode based on system preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.classList.add('dark-mode');
                darkModeToggle.checked = true;
                updateToggleText(true);
            } else {
                updateToggleText(false);
            }
            
            // Event listeners
            prevBtn.addEventListener('click', showPreviousQuestion);
            nextBtn.addEventListener('click', showNextQuestion);
            restartBtn.addEventListener('click', restartQuiz);
            reviewBtn.addEventListener('click', showIncorrectQuestions);
            darkModeToggle.addEventListener('change', toggleDarkMode);
        }

        // Toggle dark mode
        function toggleDarkMode() {
            const isDarkMode = darkModeToggle.checked;
            document.body.classList.toggle('dark-mode', isDarkMode);
            updateToggleText(isDarkMode);
        }

        // Update toggle text opacity
        function updateToggleText(isDarkMode) {
            if (isDarkMode) {
                lightText.style.opacity = '0.5';
                darkText.style.opacity = '1';
            } else {
                lightText.style.opacity = '1';
                darkText.style.opacity = '0.5';
            }
        }

        // Show current question
        function showQuestion() {
            currentQuestionEl.textContent = currentQuestion + 1;
            scoreEl.textContent = score;
            
            const question = quizData[currentQuestion];
            let optionsHTML = '';
            
            question.options.forEach((option, index) => {
                let optionClass = 'option';
                if (userAnswers[currentQuestion] === index) {
                    optionClass += ' selected';
                    if (index === question.answer) {
                        optionClass += ' correct';
                    } else {
                        optionClass += ' incorrect';
                    }
                }
                
                optionsHTML += `
                    <div class="${optionClass}" data-index="${index}">
                        ${String.fromCharCode(65 + index)}) ${option}
                    </div>
                `;
            });
            
            let feedbackHTML = '';
            if (userAnswers[currentQuestion] !== null) {
                const isCorrect = userAnswers[currentQuestion] === question.answer;
                const correctLetter = String.fromCharCode(65 + question.answer);
                const correctAnswerText = question.options[question.answer];
                
                feedbackHTML = `
                    <div class="feedback ${isCorrect ? 'correct' : 'incorrect'}">
                        ${isCorrect ? '✓ Correct!' : '✗ Incorrect!'} 
                        ${!isCorrect ? `Correct answer: ${correctLetter}) ${correctAnswerText}` : ''}
                        <br><br>Explanation: ${question.explanation}
                    </div>
                `;
            }
            
            quizContainer.innerHTML = `
                <div class="question">
                    <div class="question-number">Question ${currentQuestion + 1}/${quizData.length}</div>
                    <div class="question-text">${question.question}</div>
                    <div class="options">${optionsHTML}</div>
                    ${feedbackHTML}
                </div>
            `;
            
            // Add event listeners to options
            const optionElements = quizContainer.querySelectorAll('.option');
            optionElements.forEach(option => {
                option.addEventListener('click', selectOption);
            });
            
            // Update navigation buttons
            prevBtn.disabled = currentQuestion === 0;
            nextBtn.textContent = currentQuestion === quizData.length - 1 ? 'Finish Quiz' : 'Next';
        }

        // Select an option
        function selectOption(e) {
            if (userAnswers[currentQuestion] !== null) return; // Already answered
            
            const selectedOption = e.currentTarget;
            const selectedIndex = parseInt(selectedOption.dataset.index);
            
            userAnswers[currentQuestion] = selectedIndex;
            
            // Check if answer is correct
            if (selectedIndex === quizData[currentQuestion].answer) {
                score++;
                scoreEl.textContent = score;
            } else {
                // Add to incorrect questions list
                incorrectQuestions.push({
                    question: quizData[currentQuestion].question,
                    userAnswer: selectedIndex,
                    correctAnswer: quizData[currentQuestion].answer,
                    options: quizData[currentQuestion].options,
                    explanation: quizData[currentQuestion].explanation,
                    questionNumber: currentQuestion + 1
                });
            }
            
            showQuestion();
            updateProgressBar();
        }

        // Show next question
        function showNextQuestion() {
            if (currentQuestion < quizData.length - 1) {
                currentQuestion++;
                showQuestion();
            } else {
                showResults();
            }
        }

        // Show previous question
        function showPreviousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion();
            }
        }

        // Update progress bar
        function updateProgressBar() {
            const progress = ((currentQuestion + 1) / quizData.length) * 100;
            progressBar.style.width = `${progress}%`;
        }

        // Show results
        function showResults() {
            quizContainer.style.display = 'none';
            document.querySelector('.navigation').style.display = 'none';
            document.querySelector('.progress-container').style.display = 'none';
            document.querySelector('.stats').style.display = 'none';
            
            finalScoreEl.textContent = score;
            
            // Performance message
            const percentage = (score / quizData.length) * 100;
            let message = '';
            if (percentage >= 80) {
                message = 'Excellent! You have a strong understanding of the Visual System.';
            } else if (percentage >= 60) {
                message = 'Good job! You have a solid grasp of the material.';
            } else if (percentage >= 40) {
                message = 'Not bad! Review the material and try again.';
            } else {
                message = 'Keep studying! Review the lectures and try again.';
            }
            
            performanceMessageEl.textContent = message;
            resultsContainer.style.display = 'block';
            
            // Show review button only if there are incorrect answers
            if (incorrectQuestions.length > 0) {
                reviewBtn.style.display = 'inline-block';
            } else {
                reviewBtn.style.display = 'none';
            }
        }

        // Show incorrect questions
        function showIncorrectQuestions() {
            resultsContainer.style.display = 'none';
            reviewSection.style.display = 'block';
            
            let incorrectHTML = '';
            incorrectQuestions.forEach((item, index) => {
                const correctLetter = String.fromCharCode(65 + item.correctAnswer);
                const userLetter = String.fromCharCode(65 + item.userAnswer);
                
                incorrectHTML += `
                    <div class="review-question">
                        <div class="review-question-number">Question ${item.questionNumber}</div>
                        <div class="review-question-text">${item.question}</div>
                        <div>Your answer: ${userLetter}) ${item.options[item.userAnswer]}</div>
                        <div class="review-answer review-correct">Correct answer: ${correctLetter}) ${item.options[item.correctAnswer]}</div>
                        <div class="review-explanation">${item.explanation}</div>
                    </div>
                `;
            });
            
            incorrectQuestionsList.innerHTML = incorrectHTML;
        }

        // Restart quiz
        function restartQuiz() {
            currentQuestion = 0;
            score = 0;
            userAnswers = new Array(quizData.length).fill(null);
            incorrectQuestions = [];
            
            // Re-randomize the quiz data when restarting
            quizData = createRandomizedQuizData();
            
            quizContainer.style.display = 'block';
            document.querySelector('.navigation').style.display = 'flex';
            document.querySelector('.progress-container').style.display = 'block';
            document.querySelector('.stats').style.display = 'flex';
            resultsContainer.style.display = 'none';
            reviewSection.style.display = 'none';
            
            showQuestion();
            updateProgressBar();
        }

        // Initialize the quiz when the page loads
        window.onload = initQuiz;
    </script>
</body>
</html>